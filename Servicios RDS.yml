---

- name: Validaci√≥n Servicios Consolas Active Directory

  hosts: all

  gather_facts: false

  tasks:

 

    - name: Validar el estado del servicio

      ansible.windows.win_service:

        name: "{{ item }}"

      loop:

        - Dhcp

        - DPS

        - Dnscache

        - PolicyAgent

        - Spooler

      register: result

      failed_when: result is not defined

 

    - name: Si el servicio esta 'stopped' cambiar a 'started'

      ansible.windows.win_service:

        name: "{{ result.results[ansible_loop.index0 - 1].name }}"

        state: started

      when: "'stopped' in result.results[ansible_loop.index0 - 1].state"

      loop: "{{ result.results }}"